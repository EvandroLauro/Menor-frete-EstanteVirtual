<html>
    <head>
        
    </head>
    <link rel="stylesheet" type="text/css" href="style.css">
    <!--=<script type="text/javascript" src="index.js"></script>-->
    <body>
        <div id="corpo-externo">
            <div id="corpo-interno-um">
                <input id="input-pagina-um" type="text" value="Adicione o ISBN"/>
                <button id="btnAdicionar-pagina-um" type="button" onclick='adicionarISBN()'>Adicionar</button>
                <div id="list-isbn"></div>
            </div>
        </div>
    </body>
</html>

<script>
    /*
        Proxima incrementação é, ao passar o mouse em cima do X(deleta), é para a seta virar uma maozinha e aparecer
        um balaozinho escrito excluir, depois aparecer um alerta perguntando se o usuario quer realmente excluir o isbn
        nesse alert que vai aparecer deve ter dois botões, Sim(que quer excluir) e não(nao quer excluir), se sim delata 
        o isbn e fecha o alert, se n só fecha o alert.
    */
    function adicionarISBN() {
        let input = document.getElementById("input-pagina-um");
        let isbn = input.value.replace(/\s/g, ''); // Remove espaços em branco entre os caracteres
        if (isRepetido(isbn) == isbn && !(isbn == "")) {
            alert(`'${isbn}' FOI INSERIDO, ADICIONE OUTRO ISBN!`);
            input.value = 'Adicione o ISBN';
        } else if (isValid(isbn) == true) {
            alert(`O VALOR '${isbn}' INSERIDO É INVÁLIDO, TENTE OUTRO!`);
            input.value = 'Adicione o ISBN';
        } else if (!(isbn == "" || isbn == 'AdicioneoISBN')) {
            addElement(isbn);
            addTextISBN(isbn);
            addBtnExcluirISBN(isbn);
            scrollBarListISBN();
            input.value = 'Adicione o ISBN';
        }

        function isRepetido(isbn) {
            let filhos = document.getElementById("list-isbn").children;
            return Object.entries(filhos).map((elem, index) => filhos.item(index).innerText.replace(/X+\n/,'')).filter((elem) => elem == isbn);
        }

        /* 
            Impede que espaços em branco seja inserido, depois vou impedir que outros valores seja inserido
            os valores que pode ser inserido é apenas 5835385385(numeros) e valores igual a esse 978-8573076103
        */
        function isValid(isbn) {
            return /^\s*$/.test(isbn);
        }

        function addElement(isbn) {
            let element = document.createElement("div");    
            element.setAttribute("id", isbn);
            element.setAttribute("class", "element-isbn");
            document.getElementById("list-isbn").prepend(element);  
        }

        function addTextISBN(isbn) {
            let textISBN = document.createElement("div");
            let idTextISBN = "isbn-".concat(isbn);
            textISBN.setAttribute("id", idTextISBN);
            textISBN.setAttribute("class", "text-isbn");
            document.getElementById(isbn).prepend(textISBN);
            document.getElementById(idTextISBN).innerText = isbn;
        }

        function addBtnExcluirISBN(isbn) {
            let btnExcluirISBN = document.createElement("button");
            let idBtnExcluirISBN = "btn-excluir-".concat(isbn);
            btnExcluirISBN.setAttribute("id", idBtnExcluirISBN);
            btnExcluirISBN.setAttribute("class", "btn-excluir-isbn");
            btnExcluirISBN.setAttribute("onclick", `excluirISBN('${isbn}')`);
            document.getElementById(isbn).prepend(btnExcluirISBN);
            document.getElementById(idBtnExcluirISBN).innerText = "X";
        }
        
    }

    function excluirISBN(id) {
        let element = document.getElementById(id);
        element.remove();
        scrollBarListISBN();
    }

    function scrollBarListISBN() { 
        let pai = document.getElementById("list-isbn")
        let filhos = pai.children;
        let quantidade = Object.entries(filhos).map((elem, index) => filhos.item(index).innerText.replace(/X+\n/,''))  
        if (quantidade.length == 14) {
            pai.style.overflowY = "scroll";
        } else if (quantidade.length == 13) {
            pai.style.overflowY = "hidden";
        }
    }

    function clickDescliqueInput() {
        let btnAdicionar = document.getElementById("btnAdicionar-pagina-um");
        let input = document.getElementById("input-pagina-um"); 
        input.addEventListener("click", function(event) {
            input.value = "";
        });
        
        // Não entendo muito bem como esse contains(event.target) funciona
        document.addEventListener('click', function(event) {              
            let isClickInsideElementInput = input.contains(event.target); 
            let isClickInsideElementBtnAdicionar = btnAdicionar.contains(event.target);
            if (!isClickInsideElementInput && !isClickInsideElementBtnAdicionar && input.value == "Adicione o ISBN") {
                input.value = "Adicione o ISBN";
            } else if (!isClickInsideElementInput && !isClickInsideElementBtnAdicionar && input.value == "") {
                input.value = "Adicione o ISBN";
            } else if (isClickInsideElementBtnAdicionar && input.value == "") {
                input.value = "Adicione o ISBN";
            }
        });
    }

    
   
    window.addEventListener("load", clickDescliqueInput);

</script>