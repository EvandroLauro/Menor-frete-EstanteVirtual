<html>
    <head>
        
    </head>
    <link rel="stylesheet" type="text/css" href="style.css">
    <!--=<script type="text/javascript" src="index.js"></script>-->
    <body>
        <div id="corpo-externo">
            <div id="corpo-interno-um">
                <input id="input-pagina-um" type="text" value="Adicione o ISBN"/>
                <button id="btnAdicionar-pagina-um" type="button" onclick='adicionarISBN()'>Adicionar</button>
                <div id="list-isbn"></div>
            </div>
        </div>
    </body>
</html>

<script>

    function adicionarISBN() {
        let input = document.getElementById("input-pagina-um");
        let isbn = input.value.replace(/\s/g, ''); // Remove espaços em branco
        if (isRepetido(isbn) == isbn && !(isbn == "")) {
            alert(`'${isbn}' FOI INSERIDO, ADICIONE OUTRO ISBN!`);
            input.value = 'Adicione o ISBN';
        } else if (isValid(isbn) == true) {
            alert(`O VALOR '${isbn}' INSERIDO É INVÁLIDO, TENTE OUTRO!`);
            input.value = 'Adicione o ISBN';
        } else if (!(isbn == "" || isbn == 'AdicioneoISBN')) {
            addElement(isbn)
            addText(isbn)
            addBtnDelete(isbn)
            input.value = 'Adicione o ISBN';
        }

        function isRepetido(isbn) {
            let filhos = document.getElementById("list-isbn").children;
            return Object.entries(filhos).map((elem, index) => filhos.item(index).innerText.replace(/x+\n/,'')).filter((elem) => elem == isbn);
        }

        // Impede que espaços em branco seja inserido, depois vou impedir que outros valores seja inserido
        function isValid(isbn) {
            return /^\s*$/.test(isbn);
        }

        function addElement(isbn) {
            let element = document.createElement("div");    
            element.setAttribute("id", isbn);
            element.setAttribute("class", "element-isbn");
            document.getElementById("list-isbn").prepend(element);  
        }

        function addText(isbn) {
            let text = document.createElement("div");
            let idText = "ISBN-".concat(isbn);
            text.setAttribute("id", idText);
            text.setAttribute("class", "text-isbn");
            document.getElementById(isbn).prepend(text);
            document.getElementById(idText).innerText = isbn;
        }

        function addBtnDelete(isbn) {
            let btnDelete = document.createElement("button")
            let idBtnDelete = "btn-delete-".concat(isbn)
            btnDelete.setAttribute("id", idBtnDelete);
            btnDelete.setAttribute("class", "btn-delete-isbn");
            btnDelete.setAttribute("onclick", `deletarISBN('${idBtnDelete}')`)
            document.getElementById(isbn).prepend(btnDelete);
            document.getElementById(idBtnDelete).innerText = "x";
        }
        
    }

    function deletarISBN(id) {
        console.log(id)
    }

    function clickDescliqueInput() {
        let btnAdicionar = document.getElementById("btnAdicionar-pagina-um");
        let input = document.getElementById("input-pagina-um"); 
        input.addEventListener("click", function(event) {
            input.value = "";
        });
        
        // Não entendo muito bem como esse contains(event.target) funciona
        document.addEventListener('click', function(event) {              
            let isClickInsideElementInput = input.contains(event.target); 
            let isClickInsideElementBtnAdicionar = btnAdicionar.contains(event.target)
            if (!isClickInsideElementInput && !isClickInsideElementBtnAdicionar && input.value == "Adicione o ISBN") {
                input.value = "Adicione o ISBN";
            } else if (!isClickInsideElementInput && !isClickInsideElementBtnAdicionar && input.value == "") {
                input.value = "Adicione o ISBN";
            } else if (isClickInsideElementBtnAdicionar && input.value == "") {
                input.value = "Adicione o ISBN";
            }
        });
    }
   
    window.addEventListener("load", clickDescliqueInput);

   

</script>